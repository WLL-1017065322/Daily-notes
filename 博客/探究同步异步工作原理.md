





## 前言

> JS引擎在运行同步代码的时候按照顺序运行的方式，而如果遇见异步代码将会短暂挂起，放入事件循环队列(Event Loop)末端，一次执行。

```
//you may have seen the following code

for (var i = 0; i < 3; i++) {
    
    setTimeout(function timeoutHandle() {
      console.log(i);
    },1000);
}
```

> 但是如果如上述代码所示，加上一个定时器又如何理解呢？在同步代码循环结束完毕之后，三个异步事件挂起，等到1秒时间到了之后，三个异步事件依次放入事件循环队列中执行，而同步代码中`循环中的每一次迭代都会给自己捕获一个i的副本，但是根据作用域的工作原理，实际情况是尽管循环中的三个函数是在各个迭代中分别定义的，但是他们都被封闭在一个共享的全局作用域中，因此实际只有一个i`。

## 探析

> 对于`var`关键字声明变量有着诸多诟病，那就是会造成污染全局变量的风险，比如上述的for循环中，假如在for循环体之外再次打印，引擎依旧会给出泄露出去的全局变量i，当然这是很危险的。我们不妨用一下`let`关键字。

```
for (let i = 0; i < 3; i++ ){
   setTimeout(function timeoutHandle() {
     console.log(i);
   });
}
```

> 你会惊喜的发现打印结果是预期顺序。

> 那是因为`for`循环的头部的let声明还会有一个特殊的行为。这个行为指出变量在循环过程中不止被声明一次。`每次迭代`都会声明。随后的每个迭代都会使用上一个迭代结束时的值来初始化这个变量。

原始链接： [https://bigbigdreamer.github.io/76f810b0/](https://ivu1314.club/76f810b0/)

